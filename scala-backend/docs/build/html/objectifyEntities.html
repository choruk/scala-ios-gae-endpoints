<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Modeling The Entities &mdash; TicTacToe 1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="TicTacToe 1 documentation" href="index.html" />
    <link rel="next" title="The Backend API Implementation" href="apiImplementation.html" />
    <link rel="prev" title="The Servlet Context Listener" href="servletListener.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="apiImplementation.html" title="The Backend API Implementation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="servletListener.html" title="The Servlet Context Listener"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">TicTacToe 1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="modeling-the-entities">
<h1>Modeling The Entities<a class="headerlink" href="#modeling-the-entities" title="Permalink to this headline">¶</a></h1>
<p>As mentioned in the Technologies section, the Objectify framework was used to interact with the App Engine datastore. When starting a project that uses Objectify, you first need to model the entities that your application will be placing into the datastore. You then annotate your entities properly, following the <a class="reference external" href="http://code.google.com/p/objectify-appengine/wiki/Entities">official documentation</a>, and you are ready to start storing and loading your data.</p>
<div class="section" id="objectify-configurations">
<h2>Objectify Configurations<a class="headerlink" href="#objectify-configurations" title="Permalink to this headline">¶</a></h2>
<p>All of the entities used by the TicTacToe application inherit from a common base class named <em>Game</em> and can be found in the <em>Game.scala</em> file. The <em>Game</em> base class is labeled with the <em>&#64;Entity</em> annotation, while the subclasses are labeled with the <em>&#64;EntitySubclass</em> annotation; displaying Objectify polymorphism in action. The <em>index=true</em> specification on the annotations of the subclasses lets Objectify know that we wan&#8217;t to query on these classes. Behind the scenes, Objectify is actually creating another property on our entities specifying their underlying class type. Objectify also requires all entities to have a no-arg constructor, which explains the private <em>this()</em> methods in all of the subclasses.</p>
<blockquote>
<div><strong>Note:</strong> Scala creates a no-arg constructor for the Game base class implicitly.</div></blockquote>
<p>Another important Objectify-related configuration lies in the use of the <em>&#64;Index</em> annotations. As per the <a class="reference external" href="http://code.google.com/p/objectify-appengine/wiki/BestPractices">best practices</a>, you should use indexes sparingly and only on properties that you will need to query on. For this reason, only the <em>user1</em>, <em>user2</em>, and <em>date</em> properties are indexed in TicTacToe&#8217;s entities.</p>
</div>
<div class="section" id="limitations">
<h2>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline">¶</a></h2>
<p>One of the limitations of using Objectify is the lack of support for an abstract base class. The <em>Game</em> class should really be abstract and never directly instantiated, but adding the <em>abstract</em> keyword to the class definition causes a runtime exception to be thrown by Objectify. The exception essentially states that Objectify was unable to instantiate an abstract class without more specific type information. One possible workaround for this issue would be to simply remove the <em>&#64;Entity</em> annotation from the abstract base class and place this annotation on each of the concrete subclasses. The disadvantages to this approach are that this will create a separate datastore kind for each of the subclasses and it requires an amount of code-repeat proportional to the amount of code in the abstract base class (since you have to override the member properties for Objectify to pick up on them).</p>
<p>While this workaround could have been implemented for TicTacToe, another limitation surrounding abstract base classes is introduced by using the Google Cloud Endpoints service. As evidenced by the <em>findOrCreateGame()</em> method of the <em>MatchmakingController</em> class, an abstract base class is useful because it can be used to return an object with a type corresponding to any of the concrete subclasses. However, because of how the endpoints tool generates the API client libraries and configuration files, the underlying type of the object returned by the <em>findOrCreateGame()</em> method will always be <em>Game</em>. When the client sends a <em>Game</em> object back to the API backend, it will have type <em>Game</em> and not one of the subclass types. If <em>Game</em> is abstract, this will cause the JSON serializer to throw an exception complaining about how it cannot serialize an abstract class.</p>
<p>Unfortunately, due to the limitations just mentioned, some nice Scala features like pattern matching cannot be utilized because the underlying type of a parameter with type <em>Game</em> will always be <em>Game</em>. While this doesn&#8217;t severely affect the TicTacToe application, for a more complex application this lack of support might not be acceptable. Luckily, there will be support in the future for abstract base classes in Objectify, likely using an annotation such as <em>&#64;EntityBase</em>. Once this support is released, the workaround mentioned in the Objectify section of the Techonologies page about having a separate internal and external representation could be used to workaround the issue introduced by Google Cloud Endpoints.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Modeling The Entities</a><ul>
<li><a class="reference internal" href="#objectify-configurations">Objectify Configurations</a></li>
<li><a class="reference internal" href="#limitations">Limitations</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="servletListener.html"
                        title="previous chapter">The Servlet Context Listener</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="apiImplementation.html"
                        title="next chapter">The Backend API Implementation</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/objectifyEntities.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="apiImplementation.html" title="The Backend API Implementation"
             >next</a> |</li>
        <li class="right" >
          <a href="servletListener.html" title="The Servlet Context Listener"
             >previous</a> |</li>
        <li><a href="index.html">TicTacToe 1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Chris Horuk.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>